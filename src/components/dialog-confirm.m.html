<script type="module">
  import { defineComponent, reactive } from 'elii'
  import { images } from '@/r.js'

  import './x-text.m.html'
  import './x-icon.m.html'
  import './x-button.m.html'
  import XDialog from './x-dialog.m.html'

  export default defineComponent({
    tag: 'dialog-confirm',
    document: import.meta.document,
    setup() {
      const state = reactive({
        refDialog: /** @type {XDialog | null} */ (null),
        onAccept: /** @type {(() => void) | null} */ (null),
        message: '',
      })

      /**
       * @param {string} message
       * @param {() => void} onAccept
       */
      const open = (message, onAccept) => {
        state.message = message
        state.onAccept = onAccept
        state.refDialog?.open()
      }

      const close = () => {
        state.refDialog?.close()
      }

      const accept = () => {
        state.onAccept?.()
        close()
      }

      return {
        images,
        state,
        $expose: {
          open,
        },
        close,
        accept,
      }
    },
  })
</script>

<template>
  <x-dialog data-ref="state.refDialog" no-close>
    <template data-for="line in state.message.split('\n')">
      <x-text class="title" data-prop-value="line"></x-text>
    </template>

    <div class="buttons">
      <x-button shadow data-on-click="close">
        <x-icon data-prop-svg-url="images.icon.close"></x-icon>
      </x-button>
      <x-button shadow data-on-click="accept">
        <x-icon data-prop-svg-url="images.icon.circle"></x-icon>
      </x-button>
    </div>
  </x-dialog>
</template>

<style>
  :host {
    display: contents;
  }

  .title {
    display: block;
    text-align: center;
    font-size: 20px;
    line-height: 1.3;
  }

  .buttons {
    display: flex;
    justify-content: space-evenly;
    margin-top: 24px;
    color: darkorange;
  }
</style>
