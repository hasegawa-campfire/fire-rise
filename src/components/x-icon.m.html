<script type="module">
  import { defineComponent } from 'elii'
  import { images } from '@/r.js'

  export default defineComponent({
    tag: 'x-icon',
    document: import.meta.document,
    props: {
      svgUrl: '',
      disabled: false,
      shadow: true,
    },
    setup(props) {
      return {
        props,
        images,
      }
    },
  })
</script>

<template>
  <svg class="icon" viewBox="-4 -4 32 32">
    <defs>
      <!-- 波マスク（上部を表示、下部を隠す） -->
      <filter id="toBlack">
        <feColorMatrix type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" />
      </filter>
      <mask id="waveMask">
        <rect x="-4" y="-4" width="32" height="32" fill="white" />
        <image
          data-attr-href="images.wave"
          x="-4"
          y="0"
          width="32"
          height="24"
          preserveAspectRatio="none"
          filter="url(#toBlack)"
        />
      </mask>
    </defs>
    <!-- 外側の縁取り -->
    <use
      class="stroke-outer"
      data-attr-href="`${props.svgUrl}#icon`"
      data-attr-stroke="props.shadow ? (props.disabled ? '#ccc' : '#fff') : 'none'"
      fill="none"
      paint-order="stroke"
    />
    <!-- 内側の縁取り -->
    <use
      class="stroke-inner"
      data-attr-href="`${props.svgUrl}#icon`"
      data-attr-stroke="props.disabled ? '#888' : '#5d1a00'"
      fill="none"
      paint-order="stroke"
    />
    <!-- ベース塗り -->
    <use class="base" data-class-disabled="props.disabled" data-attr-href="`${props.svgUrl}#icon`" />
    <!-- 上部塗り（通常時のみ波マスク適用） -->
    <use
      class="fill"
      data-class-disabled="props.disabled"
      data-attr-href="`${props.svgUrl}#icon`"
      data-attr-mask="props.disabled ? '' : 'url(#waveMask)'"
    />
  </svg>
</template>

<style>
  :host {
    display: block;
    position: relative;
    aspect-ratio: 1;
    width: 48px;
  }

  .icon {
    width: 100%;
    height: 100%;
  }

  .stroke-outer {
    stroke-width: calc(var(--border-width) * 2);
  }

  .stroke-inner {
    stroke-width: var(--border-width);
  }

  .base {
    &.disabled {
      fill: #ccc;
    }

    &:not(.disabled) {
      fill: var(--wave-color, #fff);
    }
  }

  .fill {
    &.disabled {
      fill: none;
    }

    &:not(.disabled) {
      fill: currentColor;
    }
  }
</style>
