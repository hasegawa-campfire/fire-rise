<script type="module">
  import { defineComponent, reactive } from 'elii'
  import { setCategoryVolume } from '@/lib/audio.js'
  import { prefs, se } from '@/r.js'

  import './x-text.m.html'
  import XDialog from './x-dialog.m.html'

  export default defineComponent({
    tag: 'dialog-settings',
    document: import.meta.document,
    setup() {
      const state = reactive({
        refDialog: /** @type {XDialog | null} */ (null),
      })

      const open = () => {
        state.refDialog?.open()
      }

      const onPointerDown = () => {
        se.click.play()
      }

      /**
       * @param {{currentTarget: HTMLInputElement}} e
       */
      const onInputBgm = (e) => {
        setCategoryVolume('bgm', e.currentTarget.valueAsNumber)
        se.click.play()
      }

      /**
       * @param {{currentTarget: HTMLInputElement}} e
       */
      const onInputSe = (e) => {
        setCategoryVolume('se', e.currentTarget.valueAsNumber)
        se.click.play()
      }

      return {
        state,
        prefs,
        onPointerDown,
        onInputBgm,
        onInputSe,
        $expose: {
          open,
        },
      }
    },
  })
</script>

<template>
  <x-dialog data-ref="state.refDialog">
    <x-text class="title" value="サウンド"></x-text>
    <label>おんがく</label>
    <input
      class="slider"
      type="range"
      min="0"
      max="1"
      step="0.1"
      data-model-value-as-number="prefs.volumeBgm"
      data-on-pointerdown="onPointerDown"
      data-on-input="onInputBgm"
      data-style-background-size="`${prefs.volumeBgm * 100}% 100%`"
    />
    <label>こうかおん</label>
    <input
      class="slider"
      type="range"
      min="0"
      max="1"
      step="0.1"
      data-model-value-as-number="prefs.volumeSe"
      data-on-pointerdown="onPointerDown"
      data-on-input="onInputSe"
      data-style-background-size="`${prefs.volumeSe * 100}% 100%`"
    />
  </x-dialog>
</template>

<style>
  :host {
    display: contents;
  }

  .title {
    display: block;
    text-align: center;
    font-size: 20px;
  }

  label {
    margin-top: 24px;
    display: block;
    font-size: 14px;
    color: #5d1a00;
    line-height: 1;
  }

  .sliders {
    margin-top: 32px;
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px 4px;
    align-items: center;
  }

  .slider {
    appearance: none;
    width: 100%;
    height: 8px;
    border: 2px solid #5d1a00;
    border-radius: 9999px;
    background-color: #ddd;
    background-image: linear-gradient(to right, gold, gold);
    background-size: 50% 100%;
    background-repeat: no-repeat;
    cursor: pointer;
    box-sizing: border-box;
  }

  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 24px;
    border: 3px solid #5d1a00;
    border-radius: 6px;
    background-color: gold;
    background-image: var(--images-wave);
    background-size: auto 100%;
    background-repeat: no-repeat;
    background-position: center;
    box-shadow: 0 0 0 3px #fff;
  }
</style>
